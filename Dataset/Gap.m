%% Gap.m (By: Nilofar Rastin,Farinaz Falahpour)
%Inst is  total Database
%Instance is one Instance from Data base
%numFeat is the number of features in database
%numInst is the number of instances in database
%j is the index of instance(j=1 or 2 or ... 4096)
%% Gap=Loc(x)-Lt(Uc)
function [myGap]=Gap(j,Inst,Instance,numFeat,numInst)

load('Domain.mat');
load('Out.mat'); 

loc=0;
%%
%calculating the sum of  loc(xi) for one instance
%%
%% *********ba repmat betonim in halghe ra hazf konim (loc)repeat mikonim be
%% jaye find ham ke estefade kardim az cellfun ? estefade mikonim
for i=1:numFeat
    index=find(Instance(i)==Domain{i});
    loc=loc+Out{i}(index);
end

SpamLable=1813;
EmailLable=2788;

%%
%Calculate email and spam probability  P(+) and P(-)
%%
ProbEmail=EmailLable/numInst;%p(+)
ProbSpam=SpamLable/numInst;%p(-)
%%
%Calculate Log(P(+)/P(-))
%%
Prob=log(ProbEmail/ProbSpam)
totalLOCx=Prob+loc;
%% 
%calculatin LT(uc)
%%
Uc00=1;%uc(-,-)=1
Uc11=1;%uc(+,+)=1
Uc01=-10;%uc(+,-)=-10 or -100 or -1000
Uc10=-1;%uc(-,+)=1
Ltc=log((Uc00-Uc10)/(Uc11-Uc01));
%%
%discritizing the gap
%%
myGap=round(totalLOCx-Ltc);

    
end
